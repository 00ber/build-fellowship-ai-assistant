---
phase: 03.2-w3-data-continuity-connect-structured-extraction-to-agent-tools
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - notebooks/workshop_03_building_ai_agents_foundations.ipynb
autonomous: true
requirements: []

must_haves:
  truths:
    - "Part 3 extraction produces a Pydantic model with cuisine, price_per_person_low, price_per_person_high, has_vegetarian, closing_time, and notes fields"
    - "After single-restaurant demo, a batch extraction cell extracts structured data from all 6 restaurant descriptions"
    - "A bridge cell builds the RESTAURANTS dict from extraction results and merges in hardcoded ratings, distances, and wait times"
    - "The merged RESTAURANTS dict is printed/displayed so students see exactly what tools will work with"
    - "get_price_range converts numeric price_per_person_low/high to dollar sign format ($, $$, $$$) using avg < 20 = $, avg < 40 = $$, else $$$"
    - "All 6 restaurants produce the same $/$$/$$$ classification as the previous hardcoded values"
    - "All downstream agent code (v1-v4) works without modification because dict key names are preserved"
    - "No double dashes (--) or emdashes remain in any modified cell"
  artifacts:
    - path: "notebooks/workshop_03_building_ai_agents_foundations.ipynb"
      provides: "W3 notebook with data continuity from extraction to agent tools"
      contains: "extracted = {}"
  key_links:
    - from: "cell-13 (RestaurantInfo Pydantic model)"
      to: "batch extraction cell"
      via: "RestaurantInfo used as response_format in parse() calls"
      pattern: "response_format=RestaurantInfo"
    - from: "batch extraction cell"
      to: "bridge cell (RESTAURANTS dict builder)"
      via: "extracted dict populated by batch extraction, consumed by bridge cell"
      pattern: "for name, info in extracted.items"
    - from: "bridge cell"
      to: "cell-26 (get_price_range tool function)"
      via: "RESTAURANTS dict with price_per_person_low/high keys read by get_price_range"
      pattern: "info\\[.price_per_person_low.\\]"
    - from: "cell-26 (get_price_range)"
      to: "agent v1-v4 cells"
      via: "get_price_range function signature unchanged, returns same $/$$/$$$ strings"
      pattern: "get_price_range"
---

<objective>
Connect Part 3 structured extraction results to Part 4+ agent tools in the Workshop 3 notebook. Currently extraction produces data that is never used again, and agent tools read from a separate hardcoded dict. This plan makes extraction the foundation that powers the agent tools.

Purpose: Close the data continuity gap so students see their extraction work directly become the agent's data source, reinforcing the "extraction as building block" lesson from Workshop 2.

Output: Updated Workshop 3 notebook where extraction results flow into agent tools through a visible bridge cell.
</objective>

<execution_context>
@/Users/karkisushant/.claude/get-shit-done/workflows/execute-plan.md
@/Users/karkisushant/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03.2-w3-data-continuity-connect-structured-extraction-to-agent-tools/03.2-CONTEXT.md
@.planning/phases/03.2-w3-data-continuity-connect-structured-extraction-to-agent-tools/03.2-RESEARCH.md
@.planning/phases/03-workshop-3-materials/03-02-SUMMARY.md
@notebooks/workshop_03_building_ai_agents_foundations.ipynb
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update extraction schema, add batch extraction, and build bridge cell</name>
  <files>notebooks/workshop_03_building_ai_agents_foundations.ipynb</files>
  <action>
Modify the W3 notebook to connect extraction output to agent tools. All changes are in-memory Python within the Jupyter notebook. Use NotebookEdit for all cell modifications.

**Step 1: Tweak Burger Barn description (cell-11)**
In the Burger Barn entry of RESTAURANT_DESCRIPTIONS, change "A no-frills burger joint" to "A no-frills American burger joint" (add the single word "American" so cuisine extraction is reliable for all 6 restaurants). No other description changes needed.

**Step 2: Update Pydantic model (cell-13)**
Replace the RestaurantInfo model with these fields (per locked decision):
- cuisine: str
- price_per_person_low: int
- price_per_person_high: int
- has_vegetarian: bool
- closing_time: str
- notes: str

This removes the old `special_notes` field and adds `cuisine`. Keep the same comment header.

**Step 3: Update single extraction demo (cell-14)**
Update the print statements after extraction to display the new fields:
- Add: `print(f"Cuisine: {info.cuisine}")`
- Change: `print(f"Notes: {info.special_notes}")` to `print(f"Notes: {info.notes}")`
- Keep price, vegetarian, closing_time prints as-is.

**Step 4: Insert batch extraction cell (new cell after cell-14)**
Insert a new code cell after cell-14 with a batch extraction loop:

```python
# Now extract from ALL restaurant descriptions
extracted = {}
for name, description in RESTAURANT_DESCRIPTIONS.items():
    completion = openai_client.chat.completions.parse(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": "Extract restaurant information from the description."},
            {"role": "user", "content": description}
        ],
        response_format=RestaurantInfo,
    )
    extracted[name] = completion.choices[0].message.parsed
    print(f"{name}: {extracted[name].cuisine}, ${extracted[name].price_per_person_low}-${extracted[name].price_per_person_high}")

print(f"\nExtracted structured data from {len(extracted)} restaurants.")
```

This teaches "demo one, then scale" (same approach as W2).

**Step 5: Replace cell-17 with bridge cell**
Replace the current hardcoded RESTAURANTS dict and WAIT_TIMES (cell-17) with the bridge cell that builds RESTAURANTS from extraction results and merges in hardcoded live data. Use the exact code from RESEARCH.md Pattern 2 + Pattern 4:

```python
# Build restaurant data from extraction results + other data sources
RESTAURANTS = {}
for name, info in extracted.items():
    RESTAURANTS[name] = {
        "cuisine": info.cuisine,
        "price_per_person_low": info.price_per_person_low,
        "price_per_person_high": info.price_per_person_high,
        "has_vegetarian": info.has_vegetarian,
        "closing_time": info.closing_time,
        "notes": info.notes,
    }

# Ratings from review aggregator (separate data source)
RATINGS = {
    "Olive Garden": 4.2, "Sushi Palace": 4.7, "Burger Barn": 3.8,
    "Taj Mahal": 4.5, "Dragon Wok": 4.0, "La Piazza": 4.8,
}

# Distance depends on the user's location (not a restaurant property)
DISTANCES = {
    "Olive Garden": 2.5, "Sushi Palace": 5.0, "Burger Barn": 1.0,
    "Taj Mahal": 3.2, "Dragon Wok": 4.5, "La Piazza": 6.0,
}

for name in RESTAURANTS:
    RESTAURANTS[name]["rating"] = RATINGS[name]
    RESTAURANTS[name]["distance_miles"] = DISTANCES[name]

# Simulated real-time wait times (changes every minute in theory)
WAIT_TIMES = {
    "Olive Garden": 25, "Sushi Palace": 45, "Burger Barn": 5,
    "Taj Mahal": 15, "Dragon Wok": 30, "La Piazza": 60,
}

# Show what our tools will work with
print("Restaurant data (extraction + live sources):\n")
for name, data in RESTAURANTS.items():
    print(f"  {name}:")
    print(f"    Cuisine: {data['cuisine']}")
    print(f"    Price: ${data['price_per_person_low']}-${data['price_per_person_high']}/person")
    print(f"    Vegetarian: {'Yes' if data['has_vegetarian'] else 'No'}")
    print(f"    Rating: {data['rating']} stars, {data['distance_miles']} mi away")
    print()
```

IMPORTANT: The bridge cell MUST appear BEFORE cells that define tool functions (cell-18, cell-26) so RESTAURANTS dict exists when tools are defined.

**Do NOT:**
- Add any narrator markdown cell explaining the extraction-to-tools connection (locked decision: connection is implicit)
- Add a separate transformation step (locked decision: Pydantic model produces tool-ready formats directly)
- Change any tool function signatures
- Change TOOL_DESCRIPTIONS or agent prompt strings
  </action>
  <verify>
Run `python3 -c` to parse the notebook JSON and verify:
1. Cell containing RestaurantInfo has fields: cuisine, price_per_person_low, price_per_person_high, has_vegetarian, closing_time, notes (no special_notes)
2. A cell exists containing `extracted = {}` and `for name, description in RESTAURANT_DESCRIPTIONS.items()`
3. A cell exists containing `for name, info in extracted.items()` and `RATINGS = {` and `DISTANCES = {` and `WAIT_TIMES = {`
4. The bridge cell appears BEFORE any cell defining `def get_wait_time` or `def get_rating`
5. Burger Barn description contains "American burger joint"
6. Total cell count is 55 (54 original + 1 new batch extraction cell; cell-17 replaced, not added)
  </verify>
  <done>
Extraction schema updated with cuisine and notes fields, batch extraction cell added after single demo, bridge cell replaces hardcoded RESTAURANTS dict with extraction-built data merged with hardcoded ratings/distances/wait_times, and the merged dict is displayed for student visibility.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update get_price_range tool and fix double dashes</name>
  <files>notebooks/workshop_03_building_ai_agents_foundations.ipynb</files>
  <action>
Two focused changes to complete the data continuity and formatting cleanup.

**Step 1: Update get_price_range in cell-26 (now cell-27 after insertion)**
The full tool redefinition cell (Part 5) redefines all 7 tools. Only `get_price_range` needs internal changes. Replace its body to compute from numeric price fields:

```python
def get_price_range(restaurant):
    """Get the price range ($, $$, $$$) of a restaurant."""
    for name, info in RESTAURANTS.items():
        if name.lower() == restaurant.lower():
            avg = (info["price_per_person_low"] + info["price_per_person_high"]) / 2
            if avg < 20:
                return "$"
            elif avg < 40:
                return "$$"
            else:
                return "$$$"
    available = ", ".join(RESTAURANTS.keys())
    return f"Restaurant '{restaurant}' not found. Available: {available}"
```

Thresholds verified against all 6 restaurants:
- Burger Barn avg $11.50 -> $ (correct)
- Dragon Wok avg $14.00 -> $ (correct)
- Olive Garden avg $20.00 -> $$ (correct, >= 20)
- Taj Mahal avg $24.00 -> $$ (correct)
- Sushi Palace avg $47.50 -> $$$ (correct)
- La Piazza avg $62.50 -> $$$ (correct)

All other tool functions in cell-26 (get_wait_time, get_rating, get_distance, get_cuisine, calculate_travel_time, list_restaurants) remain unchanged because they read keys that are preserved in the merged dict.

NOTE: cell-18 (Part 4 simple tools) only defines get_wait_time and get_rating. Neither reads price_range. No change needed for cell-18.

**Step 2: Fix all double dashes (--) in modified cells and any adjacent cells**
Search all cells in the notebook for `--` (double dash) and emdash characters. Replace with appropriate punctuation (commas, periods, colons, semicolons). Known locations from research:
- cell-0: "Building AI Agents -- Foundations" and "push further --"
- cell-2: "push further --"
- cell-4: "Interesting --"
- cell-6: "In every case --" and other instances
- cell-7: "Wait --"
- cell-15: "now used as" (if -- present)
- cell-17 (now bridge cell): should be clean from Task 1
- cell-20: "still just text!" line has "--"
- cell-26 (now cell-27): check docstrings
- cell-47 (now cell-48): check v4 function
- cell-50: check markdown

Replace EVERY instance of `--` across the ENTIRE notebook per the formatting decision. Do not leave any `--` or emdash anywhere in the notebook.

**Do NOT:**
- Change any tool function signatures (only internals of get_price_range)
- Modify TOOL_DESCRIPTIONS or agent prompts
- Change any agent v1-v4 logic
  </action>
  <verify>
1. Parse notebook and verify get_price_range contains `price_per_person_low` and `price_per_person_high` and does NOT contain `price_range` as a dict key lookup
2. Run `python3 -c` to search ALL cell sources for `--` (double dash). Result must be zero occurrences.
3. Verify no emdash characters (unicode \u2014) exist in any cell
4. Verify get_price_range function signature is still `def get_price_range(restaurant):` (unchanged)
5. Verify TOOL_DESCRIPTIONS string is unchanged
  </verify>
  <done>
get_price_range converts numeric prices to $/$$/$$$ using threshold logic, all double dashes and emdashes removed from the entire notebook, and all downstream agent behavior is preserved because tool signatures and return value formats are unchanged.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Parse notebook JSON: verify total cell count is 55
2. Verify data flow chain: RestaurantInfo model -> batch extraction -> extracted dict -> RESTAURANTS dict -> tool functions
3. Verify no cell contains `"price_range"` as a dict key (old hardcoded format) except in TOOL_DESCRIPTIONS string (which says "Price ($, $$, $$$)" as a description, not a key)
4. Verify no `--` or emdash exists anywhere in the notebook
5. Verify RESTAURANTS dict key structure includes: cuisine, price_per_person_low, price_per_person_high, has_vegetarian, closing_time, notes, rating, distance_miles
6. Verify cell ordering: descriptions -> model -> single extract -> batch extract -> bridge cell -> tool definitions
</verification>

<success_criteria>
- Extraction results flow into agent tools through a visible bridge cell
- All 6 restaurants produce identical $/$$/$$$ values as before
- All agent v1-v4 code runs without modification
- No double dashes or emdashes remain in the notebook
- Students see the merged dict displayed after the bridge cell
</success_criteria>

<output>
After completion, create `.planning/phases/03.2-w3-data-continuity-connect-structured-extraction-to-agent-tools/03.2-01-SUMMARY.md`
</output>
